QBuffer = require('./qbuffer')
QFputs = require('qfputs')

qbuf = new QBuffer({ encoding: 'utf8', delimiter: '\n' })
fp = new QFputs("out", {writemode: "w", writesize: 400000})
// 600k/s 400k buf, 360k/s 100k buf

process.stdin.on('data', function(chunk) {
    var line
    qbuf.write(chunk)
    while ((line = qbuf.getline()) !== null) fp.write(line) ; //process.stdout.emit('data', line)
})

process.stdin.on('end', function() {
    var line
    while ((line = qbuf.getline()) !== null) fp.write(line) ; //process.stdout.emit('data', line)
    //process.stdout.emit('end')

    fp.fflush(function() {
    console.log("AR: flushed")
    })
})

//process.stdout.on('drain', function() {
//console.log("AR: drained")
//})
